schema: '2.0'
stages:
  extract:
    cmd: python3 -m scripts.extract.extract
    deps:
    - path: ./scripts/extract/
      md5: 2594fe97c7cc4a8fdea65444fd09bd98.dir
      size: 57623
      nfiles: 12
    params:
      params.yaml:
        extract:
          MIN_STELLAR_MASS: 1000000000.0
          MAX_STELLAR_MASS: 1000000000000.0
          SNAPSHOTS:
          - 59
          - 63
          - 67
          - 72
          - 78
          - 84
          - 91
          SIMULATIONS:
          - TNG50-1
    outs:
    - path: ./dataset_raw/
      md5: 5e73000d0963057fc7fd0cd91bcee7a8.dir
      size: 223191428819
      nfiles: 77181
  prepare:
    cmd: python3 -m scripts.preprocessing.prepare
    deps:
    - path: ./dataset_raw/
      md5: 5e73000d0963057fc7fd0cd91bcee7a8.dir
      size: 223191428819
      nfiles: 77181
    - path: ./scripts/preprocessing/prepare.py
      md5: 9d2455b0d2644d1606608620abb95eac
      size: 11084
    params:
      params.yaml:
        prepare:
          SPLIT_SEED: 0
          SETS:
          - - TNG50-1
            - - 0.8
              - 0.1
              - 0.1
          OBSEVABLES:
          - mass
          - lookback
          UNOBSERVABLES:
          - mean_merger_lookback_time
          - mean_merger_mass_ratio
          - mass_last_maj_merger
          - lookback_time_last_maj_merger
          - exsitu
          ROOT_DESCENDANT_SPLIT: true
    outs:
    - path: ./dataset/
      md5: 21f9cb8ae407c1ab5ed7eecfcd941651.dir
      size: 12452383
      nfiles: 11
  train:
    cmd: python3 -m scripts.model.train
    deps:
    - path: ./dataset/
      md5: 21f9cb8ae407c1ab5ed7eecfcd941651.dir
      size: 12452383
      nfiles: 11
    - path: ./dataset_raw/
      md5: 5e73000d0963057fc7fd0cd91bcee7a8.dir
      size: 223191428819
      nfiles: 77181
    - path: ./scripts/model/
      md5: 22c6ab317c8d65e59480b684533441e4.dir
      size: 90117
      nfiles: 14
    outs:
    - path: ./runs/
      md5: 9d109710960e471ce5e6cd056b966e25.dir
      size: 1542397643
      nfiles: 15
  write_representation:
    cmd: python3 -m scripts.postprocessing.write_representation
    deps:
    - path: ./dataset/
      md5: 21f9cb8ae407c1ab5ed7eecfcd941651.dir
      size: 12452383
      nfiles: 11
    - path: ./dataset_raw/
      md5: 5e73000d0963057fc7fd0cd91bcee7a8.dir
      size: 223191428819
      nfiles: 77181
    - path: ./runs/
      md5: 9d109710960e471ce5e6cd056b966e25.dir
      size: 1542397643
      nfiles: 15
    - path: ./scripts/postprocessing/write_representation.py
      md5: 79f7c52cbd003968abe1984f8d937f4e
      size: 1491
    outs:
    - path: ./postprocessing/representation.npy
      md5: 5bdb49d1b1d5a17735fb94a1cc8a2996
      size: 1437312
  create_UMAP:
    cmd: python3 -m scripts.postprocessing.create_UMAP
    deps:
    - path: ./postprocessing/representation.npy
      md5: 5bdb49d1b1d5a17735fb94a1cc8a2996
      size: 1437312
    - path: ./scripts/postprocessing/create_UMAP.py
      md5: 7363fe1725f4d34a9eb7a9e1f43b5c8d
      size: 748
    outs:
    - path: ./postprocessing/umap.npy
      md5: 232f7ce8ab5361bc44e02c2d60b0bda4
      size: 22584
  train_simclr:
    cmd: python3 -m scripts.model.train_simclr
    deps:
    - path: ./dataset/
      md5: 21f9cb8ae407c1ab5ed7eecfcd941651.dir
      size: 12452383
      nfiles: 11
    - path: ./dataset_raw/
      md5: 5e73000d0963057fc7fd0cd91bcee7a8.dir
      size: 223191428819
      nfiles: 77181
    - path: ./scripts/model/losses.py
      md5: baeadb85948b485147af65a17c14cc5a
      size: 3599
    - path: ./scripts/model/resnet.py
      md5: 119eb97321e303a901b5f1430e516b07
      size: 16441
    - path: ./scripts/model/resnet_simclr.py
      md5: c1700e6ae2825ec5e0755aa8317135e7
      size: 1748
    - path: ./scripts/model/train_simclr.py
      md5: ae336127d29cbcc64263b0135007fb9d
      size: 6915
    params:
      params.yaml:
        data:
          VALID_RANGE:
          - None
          - None
          - - 7.0
            - 11.5
          - - 0.0
            - 13.7
          - None
          IMAGE_SIZE: 128
        train_simclr:
          NUM_WORKERS: 18
          LEARNING_RATE: 0.0003
          WEIGHT_DECAY: 0.0001
          BATCH_SIZE: 64
          NUM_EPOCHS: 30
          PATIENCE: 5
    outs:
    - path: ./model/resnet.pt
      md5: 14b3c3b7b5768a54f12a4f000e2a416d
      size: 125136030
